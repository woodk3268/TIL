# μ¤ν”„λ§ MVC λ΅κ·ΈμΈ μ²λ¦¬ 2 (ν•„ν„° & μΈν„°μ…‰ν„°)

---

## β… ν•™μµ μ£Όμ 

* μ„λΈ”λ¦Ώ ν•„ν„°μ™€ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ¥Ό ν†µν• μΈμ¦ νλ¦„ μ μ–΄
* κ³µν†µ κ΄€μ‹¬μ‚¬(Cross-Cutting Concern)λ¥Ό κµ¬μ΅°μ μΌλ΅ μ²λ¦¬ν•λ” λ°©λ²•

---

## π§© ν•µμ‹¬ κ°λ… μ”μ•½

| κ°λ…                    | μ„¤λ…                                                |
| --------------------- | ------------------------------------------------- |
| μ„λΈ”λ¦Ώ ν•„ν„°(Filter)        | WAS μμ¤€μ—μ„ μ‘λ™ν•λ” μλ¬Έμ¥. μ”μ²­ λ΅κ·Έ, μΈμ¦ ν•„ν„° μ μ© κ°€λ¥             |
| μ¤ν”„λ§ μΈν„°μ…‰ν„°(Interceptor) | μ¤ν”„λ§ MVCμ—μ„ DispatcherServlet μ΄ν›„μ— μ‘λ™. μ»¨νΈλ΅¤λ¬ μ „ν›„ μ μ–΄ κ°€λ¥ |
| κ³µν†µ κ΄€μ‹¬μ‚¬                | μΈμ¦, λ΅κΉ… λ“± μ—¬λ¬ μ»¨νΈλ΅¤λ¬μ—μ„ λ°λ³µλλ” μ²λ¦¬. ν•„ν„°λ‚ μΈν„°μ…‰ν„°λ΅ μ™Έλ¶€ν™”ν•¨        |

---

## π” ν•„ν„° νλ¦„ λ° μ μ©

### β… ν•„ν„° κµ¬μ΅°

```
HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ μ„λΈ”λ¦Ώ β†’ μ»¨νΈλ΅¤λ¬
```

### π”Ή LogFilter

* UUID μƒμ„± ν›„ μ”μ²­κ³Ό μ‘λ‹µ λ΅κ·Έ μ¶λ ¥
* `FilterRegistrationBean`μΌλ΅ λ“±λ΅ λ° μμ„/URL μ§€μ •

### π”Ή LoginCheckFilter

* ν™”μ΄νΈλ¦¬μ¤νΈ κ²½λ΅ μ™Έμ—λ” μ„Έμ… μ²΄ν¬ μν–‰
* λ―ΈμΈμ¦ μ‹ `/login?redirectURL=μ”μ²­κ²½λ΅`λ΅ λ¦¬λ‹¤μ΄λ ‰νΈ
* ν•„ν„° μ²΄μΈ μ¤‘λ‹¨μ„ μ„ν•΄ `return` μ²λ¦¬ ν•„μ

### π”Ή λ‹¨μ  λ° ν•κ³„

* μ”μ²­ μΆ…λ£ ν›„ νλ¦„(afterCompletion) μ μ–΄ λ¶κ°€λ¥
* URL ν¨ν„΄ μ μ–΄μ— ν•κ³„ μμ (`/*.ico`, `/css/*` λ“±λ§ κ°€λ¥)

---

## π” μΈν„°μ…‰ν„° νλ¦„ λ° μ μ©

### β… μΈν„°μ…‰ν„° κµ¬μ΅°

```
HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ μ„λΈ”λ¦Ώ β†’ μΈν„°μ…‰ν„° β†’ μ»¨νΈλ΅¤λ¬
```

### π”Ή LogInterceptor

* `preHandle`: UUID λ΅κ·Έ μ‹λ³„μ μ„¤μ •
* `afterCompletion`: μμ™Έ μ—¬λ¶€ ν¬ν•¨ μ‘λ‹µ λ΅κ·Έ μ¶λ ¥
* `handler` μ •λ³΄ λ¶„μ„ κ°€λ¥ (ν•Έλ“¤λ¬ λ©”μ„λ“ μ΄λ¦„ λ“±)

### π”Ή LoginCheckInterceptor

* `preHandle`μ—μ„ μ„Έμ… κ²€μ‚¬
* λ―ΈμΈμ¦ μ‹ λ¦¬λ‹¤μ΄λ ‰νΈ ν›„ `false` λ°ν™μΌλ΅ μ”μ²­ μ¤‘λ‹¨

### π”Ή μ„¤μ • λ°©μ‹

* `WebMvcConfigurer.addInterceptors()`λ΅ URL μ„Έλ°€ μ μ–΄
  - μ •μ  λ¦¬μ†μ¤ μ”μ²­μ„ μ μ™Έν•  μ μμ–΄ νΌν¬λ¨Όμ¤ μµμ ν™” κ°€λ¥
  - REST APIμ— λ€ν•΄μ„λ§ μ μ©ν•  μλ„ μκ³ , μ •κ·μ‹ κΈ°λ° κ²½λ΅ λ³€μ λ§¤μΉ­λ„ μ§€μ›
* `addPathPatterns`, `excludePathPatterns`λ΅ μ •μ  λ¦¬μ†μ¤, λ΅κ·ΈμΈ, ν™ λ“± μ μ™Έ κ°€λ¥

### π”Ή μ¥μ 

* μμ™Έ λ°μƒ μ‹μ—λ„ afterCompletion νΈμ¶ λ³΄μ¥
* μ»¨νΈλ΅¤λ¬ μ •λ³΄(`HandlerMethod`) μ ‘κ·Ό κ°€λ¥
* μ„λΈ”λ¦Ώ ν•„ν„°λ³΄λ‹¤ μ¤ν”„λ§ ν™κ²½μ— μ μ—°ν•κ² λ€μ‘

## π” ν•„ν„° VS μΈν„°μ…‰ν„°

### β… 1. μ”μ²­ μ •λ³΄ μ²λ¦¬ μμ¤€μ μ°¨μ΄
| ν•­λ©         | μ„λΈ”λ¦Ώ ν•„ν„°                                     | μ¤ν”„λ§ μΈν„°μ…‰ν„°                                                                                     |
| ---------- | ------------------------------------------ | -------------------------------------------------------------------------------------------- |
| μ”μ²­ μ²λ¦¬ μ„μΉ   | DispatcherServlet **μ΄μ „**                   | DispatcherServlet **μ΄ν›„**, μ»¨νΈλ΅¤λ¬ **μ§μ „/μ§ν›„**                                                     |
| κ°μ²΄ μ •λ³΄ μ ‘κ·Ό   | `ServletRequest`, `ServletResponse`λ§ μ ‘κ·Ό κ°€λ¥ | `HttpServletRequest`, `HttpServletResponse` + **HandlerMethod, ModelAndView λ“±** MVC μ •λ³΄ μ ‘κ·Ό κ°€λ¥ |
| μ»¨νΈλ΅¤λ¬ μ •λ³΄    | μ• μ μ—†μ                                     | `HandlerMethod`λ¥Ό ν†µν•΄ μ–΄λ–¤ μ»¨νΈλ΅¤λ¬ λ©”μ„λ“κ°€ νΈμ¶λλ”μ§€ νμ•… κ°€λ¥                                                 |
| μ„Έμ… νλΌλ―Έν„° μ£Όμ… | μλ™ μ΅°ν ν•„μ” (`request.getSession()`)          | `ArgumentResolver` λ“±κ³Ό μ΅°ν•©ν•΄ μλ™ μ£Όμ… μ²λ¦¬ κ°€λ¥                                                        |

### β… 2. URL μ μ–΄ λ° μ„¤μ • μ μ—°μ„±
| ν•­λ©        | μ„λΈ”λ¦Ώ ν•„ν„°                                 | μ¤ν”„λ§ μΈν„°μ…‰ν„°                                                                                |
| --------- | -------------------------------------- | --------------------------------------------------------------------------------------- |
| URL ν¨ν„΄ μ§€μ • | μ„λΈ”λ¦Ώ μμ¤€ (`/*`, `*.do` λ“± μ ν•μ )            | `addPathPatterns`, `excludePathPatterns`λ΅ **μ„Έλ°€ν•κ² μ μ–΄** (`/api/**`, `/members/{id}` λ“± κ°€λ¥) |
| λ¦¬μ†μ¤ μ μ™Έ μ²λ¦¬ | μ •μ  νμΌ κ²½λ΅ ν•λ“μ½”λ”©                          | `.excludePathPatterns("/css/**", "/*.ico")`μ²λΌ **λ…μ‹μ μΌλ΅ μ§€μ • κ°€λ¥**                           |
| ν•„ν„° μμ„ μ μ–΄  | `FilterRegistrationBean.setOrder()` ν•„μ” | `.order()`λ΅ λ…μ‹μ μΈ μΈν„°μ…‰ν„° μμ„ μ§€μ • κ°€λ¥                                                          |

### β… 3. μμ™Έ μ²λ¦¬ λ° λ΅κΉ… μ§€μ›
- μ„λΈ”λ¦Ώ ν•„ν„°λ” μμ™Έκ°€ λ°μƒν•΄λ„ λ΅κ·Έ ν›„ μ²λ¦¬ νλ¦„μ„ μ μ–΄ν•κΈ° μ–΄λ µκ³ , μ‘λ‹µλ„ μ§μ ‘ μ΅°μ‘ν•΄μ•Ό ν•¨
- μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” afterCompletion()μ—μ„ μμ™Έ κ°μ²΄(ex)λ¥Ό μ „λ‹¬λ°›μ•„ κ³µν†µ μμ™Έ μ²λ¦¬ κ°€λ¥
- μ¦‰, MVC νλ¦„κ³Ό μ—°λ™λ μ—λ¬ λ΅κΉ…/νΈλμ­μ… μ •λ¦¬ λ“± λΉ„μ¦λ‹μ¤ μΉν™”μ  μ²λ¦¬ κ°€λ¥

### β… 4. μ¤ν”„λ§ κΈ°λ¥κ³Όμ ν†µν•©μ„±

| κΈ°λ¥                  | μ„λΈ”λ¦Ώ ν•„ν„°   | μ¤ν”„λ§ μΈν„°μ…‰ν„°                                           |
| ------------------- | -------- | -------------------------------------------------- |
| `@ControllerAdvice` | μ—°λ™ μ• λ¨   | MVC μμ™Έ νλ¦„μ— ν†µν•©λ¨                                     |
| AOP μ—°κ³„              | μ–΄λ ¤μ›€      | `preHandle`, `postHandle` λ‹¨κ³„μ—μ„ AOPμ²λΌ μ‘λ™ κ°€λ¥         |
| μ¤ν”„λ§ Securityμ™€ μ—°κ³„    | λ³„λ„ κµ¬ν„ ν•„μ” | Security filter chainλ³΄λ‹¤ ν›„μ²λ¦¬λ΅ μ‚¬μ© κ°€λ¥ (μ„Έλ¶„ν™”λ μ‹μ  ν™μ© κ°€λ¥) |

---

## π§  μΈμ‚¬μ΄νΈ

* ν•„ν„°λ” WASμ—μ„ DispatcherServlet μ΄μ „μ— μ‹¤ν–‰λλ―€λ΅ **λ‚®μ€ λ‹¨κ³„μ κ³µν†µ μ²λ¦¬μ— μ ν•©** (ex. XSS λ°©μ–΄, IP μ°¨λ‹¨)
* μΈν„°μ…‰ν„°λ” DispatcherServlet μ΄ν›„, HandlerMapping β†’ Controller μ „ν›„μ—μ„ λ™μ‘ν•λ―€λ΅ **μ»¨νΈλ΅¤λ¬ μ¤‘μ‹¬ μΈμ¦/μΈκ°€ λ΅μ§μ— μ ν•©**


