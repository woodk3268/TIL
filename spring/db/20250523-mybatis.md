# ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  - MyBatis

---

## âœ… í•™ìŠµ ì£¼ì œ

* MyBatisì˜ íŠ¹ì§•ê³¼ ì¥ì 
* ì„¤ì • ë° ì ìš© ë°©ë²• (XML ê¸°ë°˜ SQL ì‘ì„±)
* ë™ì  ì¿¼ë¦¬, SQL ì¬ì‚¬ìš©, ê²°ê³¼ ë§¤í•‘ ë°©ì‹ ì´í•´
* JdbcTemplateê³¼ì˜ ë¹„êµ ë° ì‹¤ë¬´ í™œìš© ê¸°ì¤€

---

## ğŸ§© í•µì‹¬ ê°œë… ìš”ì•½

| í•­ëª©                                | ì„¤ëª…                              |
| --------------------------------- | ------------------------------- |
| `@Mapper`                         | MyBatis ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ ì§€ì •             |
| `#{}`                             | ë°”ì¸ë”© íŒŒë¼ë¯¸í„° (PreparedStatement ë°©ì‹) |
| `${}`                             | ë¬¸ìì—´ ì¹˜í™˜ (SQL ì¸ì ì…˜ ìœ„í—˜, ì£¼ì˜)         |
| `<if>`, `<where>`, `<foreach>`    | ë™ì  SQLì„ ìœ„í•œ í•µì‹¬ íƒœê·¸                |
| `<sql>` / `<include>`             | SQL ì¬ì‚¬ìš©                         |
| `ResultMap`                       | ê²°ê³¼ ì»¬ëŸ¼ â†’ ê°ì²´ í•„ë“œ ìˆ˜ë™ ë§¤í•‘             |
| `useGeneratedKeys`, `keyProperty` | DBê°€ ìƒì„±í•œ PK ê°’ì„ ê°ì²´ì— ìë™ ì£¼ì…         |

---

## ğŸ› ï¸ ì ìš© ë‹¨ê³„ ìš”ì•½

### 1. ì„¤ì • ì¶”ê°€

```groovy
// build.gradle
implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.2.0'
```

```properties
# application.properties
mybatis.type-aliases-package=hello.itemservice.domain
mybatis.configuration.map-underscore-to-camel-case=true
```

---

### 2. ë§¤í¼ ì¸í„°í˜ì´ìŠ¤

```java
@Mapper
public interface ItemMapper {
    void save(Item item);
    void update(@Param("id") Long id, @Param("updateParam") ItemUpdateDto dto);
    Optional<Item> findById(Long id);
    List<Item> findAll(ItemSearchCond cond);
}
```

---

### 3. ë§¤í¼ XML

```xml
<mapper namespace="hello.itemservice.repository.mybatis.ItemMapper">

  <insert id="save" useGeneratedKeys="true" keyProperty="id">
    insert into item (item_name, price, quantity)
    values (#{itemName}, #{price}, #{quantity})
  </insert>

  <update id="update">
    update item
    set item_name=#{updateParam.itemName},
        price=#{updateParam.price},
        quantity=#{updateParam.quantity}
    where id = #{id}
  </update>

  <select id="findById" resultType="Item">
    select id, item_name, price, quantity from item where id = #{id}
  </select>

  <select id="findAll" resultType="Item">
    select id, item_name, price, quantity from item
    <where>
      <if test="itemName != null and itemName != ''">
        and item_name like concat('%',#{itemName},'%')
      </if>
      <if test="maxPrice != null">
        and price &lt;= #{maxPrice}
      </if>
    </where>
  </select>

</mapper>
```

---

### 4. ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„

```java
@Repository
@RequiredArgsConstructor
public class MyBatisItemRepository implements ItemRepository {
    private final ItemMapper itemMapper;

    public Item save(Item item) { itemMapper.save(item); return item; }
    public void update(Long id, ItemUpdateDto dto) { itemMapper.update(id, dto); }
    public Optional<Item> findById(Long id) { return itemMapper.findById(id); }
    public List<Item> findAll(ItemSearchCond cond) { return itemMapper.findAll(cond); }
}
```

---

### 5. ì„¤ì • í´ë˜ìŠ¤

```java
@Configuration
@RequiredArgsConstructor
public class MyBatisConfig {
    private final ItemMapper itemMapper;

    @Bean public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }
    @Bean public ItemRepository itemRepository() {
        return new MyBatisItemRepository(itemMapper);
    }
}
```

---

## ğŸ§© ë™ì  SQL ì˜ˆì‹œ

```xml
<where>
  <if test="itemName != null and itemName != ''">
    and item_name like concat('%',#{itemName},'%')
  </if>
  <if test="maxPrice != null">
    and price &lt;= #{maxPrice}
  </if>
</where>
```

* `<where>`ëŠ” ì¡°ê±´ì´ ì—†ìœ¼ë©´ ìƒëµ, ì²˜ìŒ `and`ëŠ” ìë™ ì œê±°
* ë³µì¡í•œ ì¡°ê±´ ì²˜ë¦¬ ì‹œ `<choose>`, `<when>`, `<otherwise>` ì‚¬ìš© ê°€ëŠ¥
* ë°˜ë³µ ì¡°ê±´ì€ `<foreach>`ë¡œ í•´ê²°

---

## ğŸ” ì‹¤ë¬´ ì ìš© ê¸°ì¤€

| ê¸°ì¤€        | JdbcTemplate     | MyBatis                                                    |
| --------- | ---------------- | ---------------------------------------------------------- |
| ì„¤ì • ê°„í¸ì„±    | O (ìŠ¤í”„ë§ ë‚´ì¥)       | â–³ (ë³„ë„ ì„¤ì • í•„ìš”)                                               |
| ë™ì  ì¿¼ë¦¬ í¸ì˜ì„± | X (ë³µì¡í•¨)          | O (XML ê¸°ë°˜, íƒœê·¸ ì§€ì›)                                          |
| ì¿¼ë¦¬ ì¬ì‚¬ìš©    | X                | O (`<sql>`, `<include>`)                                   |
| ë³µì¡í•œ ê²°ê³¼ ë§¤í•‘ | X (RowMapper ìˆ˜ë™) | O (`ResultMap`)                                            |
| ë‹¨ìˆœ CRUD   | O                | O                                                          |

---

## ğŸ’¡ ì¸ì‚¬ì´íŠ¸

* ë™ì  ì¿¼ë¦¬ê°€ ë§ì€ í”„ë¡œì íŠ¸ì—ì„  **MyBatis**ê°€ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬
* SQLì„ ëª…í™•íˆ ì‘ì„±í•´ì•¼ í•˜ë©°, ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ XML ë°–ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ìŒ
* **ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ êµ¬í˜„ì²´ëŠ” MyBatisê°€ ë™ì  í”„ë¡ì‹œë¡œ ìë™ ìƒì„±**


