# ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  - JPA

---

## âœ… í•™ìŠµ ì£¼ì œ

* ORM ê¸°ë°˜ì˜ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  JPA ì´í•´
* JPA ì„¤ì • ë° ê¸°ë³¸ ë§¤í•‘ ë°©ì‹
* EntityManagerë¥¼ í™œìš©í•œ CRUD êµ¬í˜„
* JPQLì„ í†µí•œ ê°ì²´ ì¤‘ì‹¬ ì¿¼ë¦¬ ì‘ì„±
* ì˜ˆì™¸ ë³€í™˜ ë° `@Repository`ì˜ ì—­í• 

---

## ğŸ§© í•µì‹¬ ê°œë… ìš”ì•½

| í•­ëª©                                     | ì„¤ëª…                                           |
| -------------------------------------- | -------------------------------------------- |
| `@Entity`                              | í•´ë‹¹ í´ë˜ìŠ¤ê°€ JPA ì—”í‹°í‹°ì„ì„ ëª…ì‹œ                         |
| `@Id`                                  | ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤(PK) ì§€ì •                             |
| `@GeneratedValue(strategy = IDENTITY)` | DBê°€ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” PK ì „ëµ (MySQL auto increment ë“±) |
| `@Column`                              | ê°ì²´ í•„ë“œì™€ í…Œì´ë¸” ì»¬ëŸ¼ ë§¤í•‘                             |
| `EntityManager`                        | JPAì˜ í•µì‹¬ API, CRUD ì²˜ë¦¬ ìˆ˜í–‰                      |
| `@Transactional`                       | ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ìˆ˜í–‰ë˜ì–´ì•¼ í•¨                     |
| `JPQL`                                 | SQL ìœ ì‚¬í•˜ì§€ë§Œ, ì—”í‹°í‹° ê°ì²´ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±                    |
| `@Repository`                          | ì˜ˆì™¸ ë³€í™˜ AOP ì ìš©ì„ ìœ„í•œ ìŠ¤í”„ë§ ì• ë…¸í…Œì´ì…˜                   |

---

## ğŸ› ï¸ ì„¤ì • ë° ì£¼ìš” ì½”ë“œ ì˜ˆì‹œ

### 1. Gradle ì„¤ì •

```groovy
// JPA, Spring Data JPA
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
// (ê¸°ì¡´ JdbcTemplate/MyBatisëŠ” ì œê±°í•´ë„ ë¨)
```

---

### 2. application.properties ì„¤ì • (JPA ë¡œê·¸)

```properties
# SQL ì¶œë ¥
logging.level.org.hibernate.SQL=DEBUG
# ë°”ì¸ë”© íŒŒë¼ë¯¸í„° ì¶œë ¥ (Boot 3.x ì´ìƒì€ ì•„ë˜ ì‚¬ìš©)
logging.level.org.hibernate.orm.jdbc.bind=TRACE
```

---

### 3. ì—”í‹°í‹° ì •ì˜

```java
@Entity
public class Item {
  @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @Column(name = "item_name", length = 10)
  private String itemName;

  private Integer price;
  private Integer quantity;
}
```

---

### 4. ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ (JpaItemRepositoryV1)

```java
@Transactional
@Repository
public class JpaItemRepositoryV1 implements ItemRepository {
  private final EntityManager em;

  public Item save(Item item) {
    em.persist(item);
    return item;
  }

  public void update(Long id, ItemUpdateDto dto) {
    Item item = em.find(Item.class, id);
    item.setItemName(dto.getItemName());
    item.setPrice(dto.getPrice());
    item.setQuantity(dto.getQuantity());
  }

  public Optional<Item> findById(Long id) {
    return Optional.ofNullable(em.find(Item.class, id));
  }

  public List<Item> findAll(ItemSearchCond cond) {
    String jpql = "select i from Item i";
    // ì¡°ê±´ì— ë”°ë¼ JPQL ì¡°ë¦½ + query.setParameter() ë¡œ ë°”ì¸ë”©
    ...
    return query.getResultList();
  }
}
```

---

### 5. JPQL íŠ¹ì§•

| SQL                  | JPQL                   |
| -------------------- | ---------------------- |
| `select * from item` | `select i from Item i` |
| í…Œì´ë¸” ê¸°ë°˜               | ì—”í‹°í‹° ê°ì²´ ê¸°ë°˜              |
| `item_name`          | `i.itemName`           |
| ë°”ì¸ë”©: `?`, `${}`      | ë°”ì¸ë”©: `:paramName`      |

---

## ğŸ§© ì˜ˆì™¸ ë³€í™˜ ë° `@Repository`

| í•­ëª©            | ì„¤ëª…                                                               |
| ------------- | ---------------------------------------------------------------- |
| `@Repository` | â‘  Component ìŠ¤ìº” ëŒ€ìƒ, â‘¡ ì˜ˆì™¸ ë³€í™˜ AOP ìë™ ì ìš©                             |
| ì˜ˆì™¸ ë³€í™˜         | JPA ì˜ˆì™¸(`PersistenceException`) â†’ ìŠ¤í”„ë§ì˜ `DataAccessException`ìœ¼ë¡œ ë³€í™˜ |
| ë‚´ë¶€ ì ìš© í´ë˜ìŠ¤     | `PersistenceExceptionTranslationPostProcessor` (ìŠ¤í”„ë§ ë¶€íŠ¸ ìë™ ë“±ë¡)    |

---

## ğŸ” ì‹¤ë¬´ ì ìš© ê¸°ì¤€

| ìƒí™©                   | JPA íŠ¹ì§•                                      |
| -------------------- | ------------------------------------------- |
| SQL ì§ì ‘ ì‘ì„± ì—†ì´ CRUD ì²˜ë¦¬ | O (ë©”ì„œë“œ í˜¸ì¶œë§Œìœ¼ë¡œ ê°€ëŠ¥)                            |
| ë™ì  ì¿¼ë¦¬ ì²˜ë¦¬             | ë¶ˆí¸í•¨ ì¡´ì¬ â†’ **QueryDSLê³¼ í•¨ê»˜ ì‚¬ìš© ê¶Œì¥**             |
| ë³µì¡í•œ ì—°ê´€ê´€ê³„ ì¡°íšŒ          | ê°ì²´ ë§¤í•‘ ê¸°ë°˜ ì²˜ë¦¬ ê°€ëŠ¥ (`@OneToMany`, `@ManyToOne`) |
| ì„±ëŠ¥ ìµœì í™”               | FetchType ì„¤ì •, ì§€ì—°ë¡œë”©, JPQL íŠœë‹ í•„ìš”              |
| í…ŒìŠ¤íŠ¸                  | `@Transactional`, `schema.sql` í™œìš© ê°€ëŠ¥        |

---

## ğŸ’¡ ì¸ì‚¬ì´íŠ¸

* JPAëŠ” ê°ì²´ ì¤‘ì‹¬ ê°œë°œ ë°©ì‹ìœ¼ë¡œ ìƒì‚°ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒì— ë§¤ìš° ìœ ë¦¬
* í•˜ì§€ë§Œ ë™ì  ì¿¼ë¦¬ ì‘ì„±ì´ë‚˜ ë³µì¡í•œ ì¡°ê±´ ì¿¼ë¦¬ì—ì„œëŠ” QueryDSLì˜ ë³´ì™„ì´ í•„ìš”
* JPAë¥¼ ë„ì…í•œ í›„ì—ëŠ” DB ì¤‘ì‹¬ ì‚¬ê³ ë³´ë‹¤ **ë„ë©”ì¸ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ ì „í™˜**ì´ í•„ìš”
* `@Repository`ì˜ ì˜ˆì™¸ ë³€í™˜ ë•ë¶„ì— ì—ëŸ¬ í•¸ë“¤ë§ ì¼ê´€ì„± í™•ë³´

