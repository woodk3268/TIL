# 빈 스코프
- 스프링 빈은 기본적으로 싱글콘 스코프로 생성된다.
- 따라서, 스프링 빈이 스프링 컨테이너의 시작과 함께 생성되어서 스프링 컨테이너가 종료될 때까지 유지된다고 학습했다.

- **스프링은 다음과 같은 다양한 스코프를 지원한다**
- **싱글톤** : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프이다.
- **프로토타입** : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 매우 짧은 범위의 스코프이다.
- **웹 관련 스코프**
   - **request** : 웹 요청이 들어오고 나갈 때까지 유지되는 스코프이다.
   - **session** : 웹 세션이 생성되고 종료될 때까지 유지되는 스코프이다.
   - **application** : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프이다.
 
## 1. 프로토타입 스코프
- 싱글톤 스코프의 빈을 조회하면 스프링 컨테이너는 항상 같은 인스턴스의 스프링 빈을 반환한다.
- 반면에 프로토타입 스코프를 스프링 컨테이너에 조회하면 스프링 컨테이너는 항상 새로운 인스턴스를 생성해서 반환한다.
- 여기서 **핵심은 스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화까지만 처리한다는 것이다.**
- 프로토타입 빈을 관리할 책임은 프로토타입 빈을 받은 클라이언트에 있으므로, @PreDestroy 같은 종료 메서드가 호출되지 않는다.

**싱글톤 스코프 빈 테스트**
```
  @Scope("singleton")
 static class SingletonBean {

  @PostConstruct
   public void init() {
     System.out.println("SingletonBean.init");
        }

   @PreDestroy
    public void destroy() {
      System.out.println("SingletonBean.destroy");
        }
    }
```

**프로토타입 스코프 빈 테스트**
```
 @Scope("prototype")
 static class PrototypeBean {

   @PostConstruct
   public void init() {
     System.out.println("PrototypeBean.init");
        }

  @PreDestroy
   public void destroy() {
     System.out.println("PrototypeBean.destroy");
        }
    }
```

- 싱글톤 빈은 스프링 컨테이너 생성 시점에 초기화 메서드가 실행되지만, 프로토타입 스코프의 빈은 스프링 컨테이너에서 빈을 조회할 때 생성되고, 초기화 메서드도 실행된다.
- 프로토타입 빈을 2번 조회하면 완전히 다른 스프링 빈이 생성되고, 초기화도 2번 실행된다.
- 싱글톤 빈은 스프링 컨테이너가 관리하기 때문에 스프링 컨테이너가 종료될 때 빈의 종료 메서드가 실행되지만,
  프로토타입 빈은 스프링 컨테이너가 생성과 의존관계 주입 그리고 초기화까지만 관여하므로 종료 메서드가 실행되지 않는다.

## 2. 프로토타입 스코프 - 싱글톤 빈과 함께 사용시 문제점
- clientBean이라는 싱글톤 빈이 의존관계 주입을 통해서 프로토타입 빈을 주입받아서 사용하는 예제를 살펴보자.
- clientBean은 싱글톤이므로, 보통 스프링 컨테이너 생성 시점에 함께 생성되고, 의존관계 주입도 발생한다.
  - 1. clientBean은 의존관계 자동 주입을 사용한다. 주입 시점에 스프링 컨테이너에 프로토타입 빈을 요청한다.
    2. 스프링 컨테이너는 프로토타입 빈을 생성해서 clientBeandp qkghksgksek.
    3. 이제 clientBean은 프로토타입 빈을 내부 필드에 보관한다.
- 클라이언트 B는 clientBean 을 스프링 컨테이너에 요청해서 받는다. 싱글톤이므로 항상 같은 clientBean이 반환된다.
- 여기서 중요한 점이 있는데, clientBean이 내부에 가지고 있는 프로토타입 빈은 이미 과거에 주입이 끝난 빈이다.
- 주입 시점에 스프링 컨테이너에 요청해서 프로토타입 빈이 새로 생성이 된 것이지, 사용 할 때마다 새로 생성되는 것이 아니다!
