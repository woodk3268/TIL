# 네트워크 계층
## 1. LAN을 넘어서는 네트워크 계층
### 1-1. 데이터 링크 계층의 한계
- **첫째, 물리 계층와 데이터 링크 계층만으로는 다른 네트워크까지의 도달 경로를 파악하기 어렵다.**
  - 물리 계층과 데이터 링크 계층은 같은 네트워크(LAN) 안에서만 통신 가능하다. 즉, 다른 네트워크로 가는 길은 알 수 없다.
  - LAN A에 있는 컴퓨터가 LAN B에 있는 컴퓨터에게 데이터를 보낼 때, 데이터는 여러 라우터와 네트워크를 거쳐야 한다.
  - 이때 어떤 길로 보내야 가장 빠르고 정확할지 최적의 경로를 결정하는 것을 **라우팅**이라고 한다.

- **둘째, MAC 주소만으로는 모든 네트워크에 속한 호스트의 위치를 특정하기 어렵다.**
  - MAC주소는 호스트를 식별하지만, 위치를 알 수 없기 때문에 전 세계 네트워크 간 데이터 전송에는 부적합하다.
  - 이때 네트워크 계층의 IP 주소를 사용해 논리적 주소로 위치를 지정한다.
  - 이 구조 덕분에 라우터가 목적지 네트워크를 인식하고 경로 선택(라우팅)이 가능하다.
 
### 1-2. 인터넷 프로토콜
- **IP주소 형태**
  - IPv4는 4바이트(=32비트)이고 각 바이트(8비트)를 10진수로 표현한다.(0~255 범위)
  - 각 10진수는 점(.)으로 구분되며, 점으로 구분된 8비트를 옥텟(octet)이라고 한다.
- **IP의 기능**
  - **IP 주소 지정** : IP 주소를 바탕으로 송수신 대상을 지정하는 것을 의미한다.
  - **IP 단편화** : 전송하고자 하는 패킷의 크기가 MTU라는 최대 전송 단위보다 클 경우, 이를 MTU 크기 이하의 복수의 패킷으로 나눈다.
 
#### 1-2-1. IPv4
- IPv4 패킷 헤더 중 식별자, 플래그, 단편화 오프셋 필드는 IP 단편화 기능에 관여하고, 송신지 IP 주소, 수신지 IP 주소는 IP 주소 지정 기능에 관여한다.
- **식별자** : 하나의 데이터가 여러 조각으로 단편화될 경우, 이 조각들은 원래 한 패킷이었다는 것 식별하는 번호이다.
- **플래그** : 총 3비트로 구성된다. (Reserved - 항상 0 , DF - Don't Fragment, MF - More Fragments)
- **단편화 오프셋** : 조각들이 원래 데이터의 어느 위치에 속했는지 알려준다.
- **TTL(Time To Live)** : 패킷이 영원히 네트워크를 떠돌지 않도록 수명을 제한한다. 라우터를 한 번 지날 때마다 1씩 감소하며 TTL=0일 때 해당 패킷은 폐기된다.
- **프로토콜** : IP 패킷 안에 어떤 상위 계층 프로토콜의 데이터가 들어있는지 나타낸다.
- **송신지 IP 주소** : 이 패킷을 보낸 장치의 IP 주소이다. 응답을 보낼 때 이 주소로 돌려보낸다.
- **수신지 IP 주소** : 이 패킷이 도착해야 할 목적지 장치의 IP 주소이다. 라우터는 이 주소를 보고 경로를 결정한다.

#### 1-2-2. IPv6
- 이론적으로 할당 가능한 IPv4 주소는 총 2^32 개로 약 43억 개이다.
- 결국 IPv4의 주소의 총량은 고갈될 수 있으므로 이런 이유에서 등장한 것이 IPv6이다.
- IPv6 주소는 16바이트(=128비트)이며, 각 2바이트(16비트)를 16진수로 표현해서 :으로 구분한다.
- **다음 헤더(next header)** : 해당 패킷 다음에 오는 상위 계층 프로토콜이나 확장 헤더 종류를 지정하는 필드이다.
- **홉 제한** : 패킷이 거칠 수 있는 최대 라우터 수를 의미한다. **IPv4의 TTL(Time To Live)**과 똑같은 역할이다.

### 1-3. ARP(Address Resolution Protocol)
- IP 주소를 MAC 주소로 바꿔주는 프로토콜이다.
- 실제 네트워크에서 데이터를 보내려면 MAC 주소가 있어야 패킷이 정확히 그 장치에 도착할 수 있다.
- ARP는 “같은 네트워크 안에서 IP를 가진 장치의 MAC 주소”를 알아내기 위한 도구이며, 다른 네트워크로 보낼 때는 라우터의 MAC 주소를 알아내는 데 사용된다.

- **과정**
- 예: 192.168.0.10이 192.168.0.20에게 데이터 보내고 싶음
- 1. MAC 주소를 모름 : 192.168.0.20의 MAC 주소를 모르니까 ARP Request를 브로드캐스트로 보낸다.
  2. 응답 수신 : 목적지 IP를 갖고 있는 장비가 ARP Reply로 응답한다.
  3. 결과 저장 : MAC 주소를 기억해두고, 실제 데이터는 이 MAC 주소를 목적지로 전송한다. ARP 캐시 테이블에 일정 시간동안 저장된다.
 
## 2. IP 주소
### 2-1. 네트워크 주소와 호스트 주소
- IP 주소에서 네트워크 주소와 호스트 주소를 구분하는 범위는 유동적일 수 있다.
- 그렇다면 네트워크 주소와 호스트 주소의 크기는 각각 어느 정도가 적당할까?
- 호스트 주소 공간을 크게 할당하면 호스트가 할당되지 않은 다수의 IP 주소가 낭비될 수 있다.
- 호스트 주소 공간을 작게 할당하면 호스트가 사용할 IP 주소가 부족해질 수 있다.
- 이런 고민을 해결하기 위해 IP 주소의 클래스라는 개념이 등장한다.

### 2-2. 클래스풀 주소 체계
- 클래스를 기반으로 IP 주소를 관리하는 주소 체계를 의미한다.
- 클래스는 네트워크 크기에 따라 IP 주소를 분류하는 기준이다.
- 클래스를 이용하면 필요한 호스트 IP 개수에 따라 네트워크 크기를 가변적으로 조정해 네트워크 주소와 호스트 주소를 구획할 수 있다.
- 클래스별 네트워크의 크기가 고정되어 있기에 여전히 다수의 IP 주소가 낭비될 가능성이 크다.

### 2-3. 클래스리스 주소 체계
- 클래스 개념 없이 네트워크의 영역을 나누어서 호스트에게 IP 주소 공간을 할당하는 방식이다.
- **서브넷 마스크** : 클래스리스 주소 체계에서 네트워크와 호스트를 구분짓는 수단이다. IP 주소 상에서 네트워크 주소는 1, 호스트 주소는 0으로 표기한 비트열을 의미한다.
- 서브넷 마스크를 이용해 클래스를 원하는 크기로 더 잘게 쪼개어 사용하는 것을 서브네팅이라고 한다.
- 주로 CIDR 표기법을 사용한다. 이는 'IP 주소/서브넷 마스크상의 1의 개수'로 표기하는 형식이다.

### 2-4. 공인 IP 주소와 사설 IP 주소
